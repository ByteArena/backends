<!DOCTYPE html>
<head>
<meta charset="utf-8">
<style>
    body {
        background: black;
        color: white;
        text-align: center;
    }

</style>
</head>
<body>

<button id="open">Connect</button>
<button id="close" style="display: none;">Close</button>
<hr />

<div id="visualization"></div>
<hr />
<div id="output"></div>

<script src="js/libs/pixi.min.js"></script>
<script src="js/libs/jquery.slim.min.js"></script>
<script src="js/app.js"></script>
<script>

PIXI.loader
    .add("images/circle.png")
    .add("images/triangle.png")
    .load(function() {

    //Create the renderer
    var renderer = PIXI.autoDetectRenderer(800, 600, { antialias: true });
    
    renderer.backgroundColor = 0xFFFFFF;
    $('#visualization').append(renderer.view);

    var stage = new PIXI.Container();
    stage.position.y = renderer.height / renderer.resolution;
    stage.scale.y = -1;

    const agenttexture = PIXI.loader.resources["images/triangle.png"].texture;
    agenttexture.rotate = 8;

    window.onStateUpdate = function(points) {
        stage.removeChildren();

        if(points.Projectiles) {
            points.Projectiles.forEach((projectile) => {
                const line = new PIXI.Graphics();

                line
                    .lineStyle(2, 0xFF0000)
                    .moveTo(projectile.From.X, projectile.From.Y)
                    .lineTo(projectile.X, projectile.Y);

                stage.addChild(line);
            });
        }

        if(points.Agents) {
            points.Agents.forEach((agent) => {

                var sprite = new PIXI.Sprite(agenttexture);

                sprite.x = agent.X;
                sprite.y = agent.Y;
                sprite.width = agent.Radius * 2;
                sprite.height = agent.Radius * 2;
                sprite.tint = 0xFF0000;
                sprite.anchor.set(0.5)
                //sprite.rotation = agent.Orientation // Math.PI/2: quart de tour vers la droite
                sprite.rotation = -1 * agent.Orientation

                //Create a container object called the `stage`
                stage.addChild(sprite);
            });
        }
        window.requestAnimationFrame(function() {
            renderer.render(stage);
        });
    };

  });

</script>
</body>
</html>
